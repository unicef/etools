FROM robertavram/etoolsreq:latest
# has py27 nodejs and all requirements (for deving and testing only)

RUN apt-get update


RUN mkdir /code

ADD EquiTrack /code/

COPY frontend /frontend/

WORKDIR /frontend/login_site/

RUN sh /frontend/login_site/loginsite.sh

WORKDIR /frontend/partner_portal/

RUN sh /frontend/partner_portal/partnerportal.sh

WORKDIR /code

ENV DJANGO_SETTINGS_MODULE EquiTrack.settings.production

# run all the build process for deployment

RUN python manage.py collectstatic --noinput

# Start everything
ENV PORT 8080
EXPOSE $PORT
ENV C_FORCE_ROOT true
CMD honcho start
