# -*- coding: utf-8 -*-
# Generated by Django 1.9.10 on 2017-05-03 14:30
from __future__ import unicode_literals
import re
from django.db import migrations


def reverse(apps, schema_editor):
    pass

def copy_pca_fr_number_to_intervention(apps, schema_editor):
    PCA = apps.get_model('partners', 'PCA')
    Intervention = apps.get_model('partners', 'Intervention')

    for pca in PCA.objects.filter(fr_number__isnull=False).exclude(fr_number__exact=''):
        try:
            intervention = Intervention.objects.get(number=pca.number)
            # if not intervention.fr_numbers:
            fr_numbers = re.split(', |;|/', pca.fr_number)
            intervention.fr_numbers = fr_numbers
            intervention.save()
            print(intervention.fr_numbers)
        except Intervention.DoesNotExist:
            print('intervention type {} does not exist'.format(pca.partnership_type))


class Migration(migrations.Migration):

    dependencies = [
        ('partners', '0026_auto_20170428_1045'),
    ]

    operations = [
        migrations.RunPython(
            copy_pca_fr_number_to_intervention, reverse_code=reverse
        ),
    ]
