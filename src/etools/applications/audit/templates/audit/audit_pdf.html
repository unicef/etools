{% extends "audit/engagement_pdf.html" %}
{% load etools %}

{% block extra_content %}
  <div class="content-section">
    <div class="content-section__header">
      <div class="content-section__header__title">Summary of engagement findings</div>
    </div>
    <div class="content-section__wrapper">
      <table class="content-section__table">
        <tr class="content-section__table__header">
          <td colspan="2"></td>
          <td colspan="2">Local Currency</td>
          <td colspan="2">USD</td>
        </tr>
        <tr>
          <td colspan="2">Value of Selected FACE</td>
          <td colspan="2">{{ engagement.total_value_local|default:"0.00"|currency }}</td>
          <td colspan="2">{{ engagement.total_value|default:"0.00"|currency }}</td>
        </tr>
        <tr>
          <td colspan="2">Audited Expenditure</td>
          <td colspan="2">{{ engagement.audited_expenditure_local|default:"0.00"|currency }}</td>
          <td colspan="2">{{ engagement.audited_expenditure|default:"0.00"|currency }}</td>
        </tr>
        <tr>
          <td colspan="2">Amount of Financial Findings</td>
          <td colspan="2">{{ engagement.pending_unsupported_amount_local|default:"0.00"|currency }}</td>
          <td colspan="2">{{ engagement.pending_unsupported_amount|default:"0.00"|currency }}</td>
        </tr>
        <tr>
          <td colspan="2">% of audited Expenditure</td>
          <td colspan="4">{{ engagement.percent_of_audited_expenditure }}</td>
        </tr>
        <tr class="content-section__table__header" >
          <td colspan="2" style="border-top: double">{{ serializer.fields.audit_opinion.label }}</td>
          <td>No. of Financial Findings</td>
          <td colspan="3" style="padding: 0">
            <table>
              <tr style="border-bottom: none;">
                <td colspan="3" style="text-align:center;">No. of Key Control Weaknesses</td>
              </tr>
              <tr class="content-section__table__header"  style="border-bottom: none;">
                <td >High risk</td>
                <td>Medium risk</td>
                <td>Low risk</td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td colspan="2">{{ engagement.audit_opinion|default:"-"|title }}</td>
          <td>{{ engagement.financial_finding_set|length }}</td>
          <td>{{ engagement.key_internal_weakness.high_risk_count }}</td>
          <td>{{ engagement.key_internal_weakness.medium_risk_count }}</td>
          <td>{{ engagement.key_internal_weakness.low_risk_count }}</td>
        </tr>
      </table>
    </div>
  </div>

  <pdf:nextpage></pdf:nextpage>

  <div class="content-section">
    <div class="content-section__header">
      <div class="content-section__header__title">Report Financial Findings</div>
    </div>
    <div class="content-section__wrapper">
      <table class="content-section__table">
        <tr class="content-section__table__header">
          <td colspan="2">Title (Category)</td>
          <td colspan="4">Description</td>
          <td colspan="2">Amount Local</td>
          <td colspan="2">Amount USD</td>
        </tr>
        {% for financial_finding in engagement.financial_finding_set %}
          <tr>
            <td colspan="2">{{ financial_finding.title|default:"-" }}</td>
            <td colspan="4">{{ financial_finding.description|default:"-" }}</td>
            <td colspan="2">{{ financial_finding.local_amount|default:"0.00"|currency }}</td>
            <td colspan="2">{{ financial_finding.amount|default:"0.00"|currency }}</td>
          </tr>
        {% endfor %}
      </table>
    </div>
  </div>

  <div class="content-section">
    <div class="content-section__header">
      <div class="content-section__header__title">{{ serializer.fields.key_internal_controls.label }}</div>
    </div>
    <div class="content-section__wrapper">
      <table class="content-section__table">
        <tr class="content-section__table__header">
          <td>{{ serializer.fields.key_internal_controls.child.fields.recommendation.label }}</td>
          <td>{{ serializer.fields.key_internal_controls.child.fields.audit_observation.label }}</td>
          <td>{{ serializer.fields.key_internal_controls.child.fields.ip_response.label }}</td>
        </tr>
        {% for control in engagement.key_internal_controls %}
          <tr>
            <td>{{ control.recommendation|default:"-" }}</td>
            <td>{{ control.audit_observation|default:"-" }}</td>
            <td>{{ control.ip_response|default:"-" }}</td>
          </tr>
        {% endfor %}
      </table>
    </div>
  </div>

  <pdf:nextpage></pdf:nextpage>

  <div class="content-section">
    <div class="content-section__header">
      <div class="content-section__header__title">Follow-Up Financial Findings</div>
    </div>
    <div class="content-section__wrapper">
      <table class="content-section__table">
        <tr class="content-section__table__header">
          <td colspan="2"></td>
          <td colspan="2">Local Currency</td>
          <td colspan="2">USD</td>
        </tr>
        <tr>
          <td colspan="2">Audited Expenditure</td>
          <td colspan="2">{{ engagement.audited_expenditure_local|default:"0.00"|currency }}</td>
          <td colspan="2">{{ engagement.audited_expenditure|default:"0.00"|currency }}</td>
        </tr>
        <tr>
          <td colspan="2">Amount Refunded</td>
          <td colspan="2">{{ engagement.amount_refunded_local|default:"0.00"|currency }}</td>
          <td colspan="2">{{ engagement.amount_refunded|default:"0.00"|currency }}</td>
        </tr>
        <tr>
          <td colspan="2">Additional Supporting Documentation Provided</td>
          <td colspan="2">{{ engagement.additional_supporting_documentation_provided_local|default:"0.00"|currency }}</td>
          <td colspan="2">{{ engagement.additional_supporting_documentation_provided|default:"0.00"|currency }}</td>
        </tr>
        <tr>
          <td colspan="2">Justification Provided and Accepted</td>
          <td colspan="2">{{ engagement.justification_provided_and_accepted_local|default:"0.00"|currency }}</td>
          <td colspan="2">{{ engagement.justification_provided_and_accepted|default:"0.00"|currency }}</td>
        </tr>
        <tr>
          <td colspan="2">Impairment</td>
          <td colspan="2">{{ engagement.write_off_required_local|default:"0.00"|currency }}</td>
          <td colspan="2">{{ engagement.write_off_required|default:"0.00"|currency }}</td>
        </tr>
        <tr>
          <td colspan="2">Pending Unsupported Amount</td>
          <td colspan="2">{{ engagement.pending_unsupported_amount_local|default:"0.00"|currency }}</td>
          <td colspan="2">{{ engagement.pending_unsupported_amount|default:"0.00"|currency }}</td>
        </tr>
      <tr>
        <td class="input-container" colspan="3">
          <div class="input-container__label">{{ serializer.fields.explanation_for_additional_information.label }}</div>
          <div class="input-container__value">
            {{ engagement.explanation_for_additional_information|default:"-" }}</div>
        </td>
      </tr>
    </table>
  </div>
</div>
{% endblock %}