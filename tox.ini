[tox]
envlist = d{110,111,20}

[testenv]
basepython=python3.6
;skip_install = True
usedevelop=True
passenv = *

;install_command=pip install --ignore-installed --force-reinstall --process-dependency-links {opts} {packages}
;extras=test
deps=
    -rsrc/requirements/test.txt

# Need some env vars set before trying to compile GDAL
# Also set one so we can tell we're running under tox.
setenv =
   CPLUS_INCLUDE_PATH=/usr/include/gdal
   C_INCLUDE_PATH=/usr/include/gdal
whitelist_externals =
                    /bin/mkdir

commands =
    mkdir -p {toxinidir}/build/flake {toxinidir}/build/results
    flake8 src/ --format=html --htmldir=build/flake
    isort -rc src/ --check-only
    pytest src/ \
            --create-db \
            --cov-report=html \
            --cov-report=xml \
            --junitxml={toxinidir}/build/junit.xml \
            --cov-config={toxinidir}/tests/.coveragerc \
            --cov=etools



[testenv:d110]
commands =
    pip install "django>1.10,<1.11"
    {[testenv]commands}


[testenv:d111]
commands =
    pip install "django>1.11,<2.0"
    {[testenv]commands}


[testenv:d20]
commands =
    pip install "django>2.0,<2.1"
    {[testenv]commands}
